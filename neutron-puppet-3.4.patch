From fbd1b1cbffbcfb7005f5ffa2de986ba320317cc2 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?P=C3=A1draig=20Brady?= <P@draigBrady.com>
Date: Fri, 20 Dec 2013 11:06:22 +0000
Subject: [PATCH] fix dnsmasq install logic rejected by puppet-3.4

---
 manifests/agents/dhcp.pp |    8 ++++++--
 manifests/params.pp      |    4 ++--
 2 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/packstack/puppet/modules/neutron/manifests/agents/dhcp.pp b/packstack/puppet/modules/neutron/manifests/agents/dhcp.pp
index cc90a57..c8dc2a1 100644
--- a/packstack/puppet/modules/neutron/manifests/agents/dhcp.pp
+++ b/packstack/puppet/modules/neutron/manifests/agents/dhcp.pp
@@ -58,9 +58,13 @@ class neutron::agents::dhcp (
   case $dhcp_driver {
     /\.Dnsmasq/: {
       Package['dnsmasq'] -> Package<| title == 'neutron-dhcp-agent' |>
-      package { 'dnsmasq':
+      package {
+        'dnsmasq':
         ensure => present,
-        name   => $::neutron::params::dnsmasq_packages,
+        name   => $::neutron::params::dnsmasq_package;
+
+        'dnsmasq-utils':
+        ensure => present;
       }
     }
     default: {
diff --git a/packstack/puppet/modules/neutron/manifests/params.pp b/packstack/puppet/modules/neutron/manifests/params.pp
index 1d5b82c..952dac8 100644
--- a/packstack/puppet/modules/neutron/manifests/params.pp
+++ b/packstack/puppet/modules/neutron/manifests/params.pp
@@ -23,7 +23,7 @@ class neutron::params {
     $dhcp_agent_package = false
     $dhcp_agent_service = 'neutron-dhcp-agent'
 
-    $dnsmasq_packages   = ['dnsmasq', 'dnsmasq-utils']
+    $dnsmasq_package   = 'dnsmasq'
 
     $lbaas_agent_package = false
     $lbaas_agent_service = 'neutron-lbaas-agent'
@@ -78,7 +78,7 @@ class neutron::params {
     $metadata_agent_package = 'neutron-metadata-agent'
     $metadata_agent_service = 'neutron-metadata-agent'
 
-    $dnsmasq_packages   = ['dnsmasq-base', 'dnsmasq-utils']
+    $dnsmasq_package   = 'dnsmasq-base'
 
     $isc_dhcp_packages  = ['isc-dhcp-server']
 
-- 
1.7.7.6

